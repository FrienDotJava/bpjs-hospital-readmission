schema: '2.0'
stages:
  data_loading:
    cmd: python src/data_loading.py
    deps:
    - path: src/data_loading.py
      hash: md5
      md5: 8b9acc064e517a36ea5ef378dfb45a01
      size: 1408
    params:
      params.yaml:
        fkrtl_gcs_path: gs://data-sample-bpjs/raw/dm_fkrtl.csv
        fktp_gcs_path: gs://data-sample-bpjs/raw/dm_fktp_kapitasi.csv
        fktp_stata_gcs_path: gs://data-sample-bpjs/stata/DM2021_fktpkapitasi.dta
        peserta_gcs_path: gs://data-sample-bpjs/raw/dm_2021_kepesertaan.csv
    outs:
    - path: data/raw/fkrtl.csv
      hash: md5
      md5: c9813a2f558e228d657e2a95a5a244a2
      size: 546385614
    - path: data/raw/fktp.csv
      hash: md5
      md5: be566ff30dd306a7579e1288d2af4dc7
      size: 190387866
    - path: data/raw/fktp_decoded.csv
      hash: md5
      md5: 91819fcab9e2e15518f01f3dd049972b
      size: 402519523
    - path: data/raw/peserta.csv
      hash: md5
      md5: 68c5df5cb1c31493774f5da9e63242a9
      size: 24800752
  data_validation:
    cmd: python src/data_validation.py
    deps:
    - path: data/raw
      hash: md5
      md5: efb837c1301fdfffe63fac76fa25716d.dir
      size: 1164093755
      nfiles: 4
    - path: src/data_validation.py
      hash: md5
      md5: b430bf732d00ac8853a47a366d752708
      size: 1904
    params:
      params.yaml:
        data.raw_data_folder: ./data/raw
  data_cleaning:
    cmd: python src/data_cleaning.py
    deps:
    - path: data/raw
      hash: md5
      md5: efb837c1301fdfffe63fac76fa25716d.dir
      size: 1164093755
      nfiles: 4
    - path: src/data_cleaning.py
      hash: md5
      md5: 2033253b0fdc115e5b77bfad5fbb691f
      size: 3728
    params:
      params.yaml:
        data_cleaning.new_column_names_fkrtl:
        - no_peserta
        - no_keluarga
        - bobot
        - id_kunjungan_fktp
        - id_kunjungan_fkrtl
        - tanggal_datang
        - tanggal_pulang
        - provinsi_fkrtl
        - kab_kota_fkrtl
        - kepemilikan_fkrtl
        - jenis_fkrtl
        - tipe_fkrtl
        - tingkat_pelayanan
        - poli_fkrtl
        - segmen_peserta
        - kelas_iuran_premi
        - status_pulang_peserta
        - kode_nama_diagnosis_ICD10
        - kode_diagnosis_ICD10
        - kode_diagnosis
        - nama_diagnosis
        - kode_nama_diagnosis_primer_ICD10
        - kode_diagnosis_primer_ICD10
        - kode_diagnosis_primer
        - nama_diagnosis_primer
        - kode_INACBGs
        - deskripsi_INACBGs
        - kode_casemix
        - kelompok_kasus
        - spesifikasi_kelompok_kasus
        - tingkat_keparahan_kelompok_kasus
        - provinsi_perujuk
        - kab_kota_perujuk
        - kepemilikan_perujuk
        - jenis_perujuk
        - tipe_perujuk
        - jenis_prosedur
        - tarif_regional_INACBGs
        - group_tarif_INACBGs
        - kode_sub_acute
        - tarif_sub_acute
        - kode_procedures
        - deskripsi_procedures
        - tarif_procedures
        - kode_prosthesis
        - deskripsi_prosthesis
        - tarif_prosthesis
        - kode_investigation
        - deskripsi_investigation
        - tarif_investigation
        - kode_drugs
        - deskripsi_drugs
        - tarif_drugs
        - biaya_tagih
        - biaya_verifikasi
        data_cleaning.new_column_names_fktp:
        - no_peserta
        - no_keluarga
        - bobot
        - id_kunjungan_fktp
        - tanggal_datang
        - tanggal_pulang
        - provinsi_fktp
        - kab_kota_fktp
        - kepemilikan_fktp
        - jenis_fktp
        - tipe_fktp
        - tingkat_pelayanan
        - poli_fktp
        - segmen_peserta
        - status_pulang_peserta
        - kode_nama_diagnosis_ICD10
        - kode_diagnosis_ICD10
        - kode_diagnosis
        - nama_diagnosis
        - provinsi_fkrtl
        - kab_kota_fkrtl
        - kepemilikan_fkrtl
        - jenis_fkrtl
        - tipe_fkrtl
        - poli_fkrtl
        - jenis_kunjungan_fktp
        data_cleaning.new_column_names_peserta:
        - no_peserta
        - no_keluarga
        - tanggal_lahir
        - hubungan_keluarga
        - gender
        - status_perkawinan
        - kelas_rawat
        - segmen_peserta
        - provinsi_tempat_tinggal
        - kab_kota_tempat_tinggal
        - kepemilikan_faskes
        - jenis_faskes
        - provinsi_faskes
        - kab_kota_faskes
        - bobot
        - tahun_sampel
        - status_peserta
        - tahun_meninggal
    outs:
    - path: data/cleaned/fkrtl.csv
      hash: md5
      md5: f1ec6eac155785df9a99f1d679c0b248
      size: 618182031
    - path: data/cleaned/fktp_decoded.csv
      hash: md5
      md5: 1b759e9c59206154d34ea34090a68f2f
      size: 404148671
    - path: data/cleaned/fktp_encoded.csv
      hash: md5
      md5: ece13f694c1c0f2e4e31a8f90f47dc8c
      size: 191086202
    - path: data/cleaned/peserta.csv
      hash: md5
      md5: cc333c14b3e2fc7ef1fca6492e8417c2
      size: 24891354
  feature_engineering:
    cmd: python src/feature_engineering.py
    deps:
    - path: data/cleaned
      hash: md5
      md5: ab6c88d6208b0aa6311570bc27365fe6.dir
      size: 1238308258
      nfiles: 4
    - path: src/feature_engineering.py
      hash: md5
      md5: 07ccd28b6eeef6646eeec92e8f9630be
      size: 9934
    params:
      params.yaml:
        feature_engineering.feature_store_cols:
        - peserta.STD(fkrtl.lama_hari_kunjungan)
        - peserta.SUM(fkrtl.jml_kunjungan_fkrtl)
        - peserta.SUM(fkrtl.lama_hari_kunjungan)
        - peserta.status_peserta
        - peserta.SUM(fktp.jarak_hari_antar_kunjungan)
        - peserta.provinsi_faskes
        - peserta.MEAN(fktp.jarak_hari_antar_kunjungan)
        - peserta.segmen_peserta
        - peserta.STD(fkrtl.spesifikasi_kelompok_kasus)
        - peserta.MAX(fkrtl.tarif_drugs)
        - peserta.kab_kota_tempat_tinggal
        - peserta.provinsi_tempat_tinggal
        - peserta.SUM(fktp.no_keluarga)
        - peserta.MEAN(fkrtl.spesifikasi_kelompok_kasus)
        - peserta.SUM(fkrtl.biaya_tagih)
        - peserta.MAX(fktp.jarak_hari_antar_kunjungan)
        - peserta.SUM(fkrtl.no_keluarga)
        - peserta.MIN(fkrtl.spesifikasi_kelompok_kasus)
        - peserta.SUM(fkrtl.bobot)
        - peserta.STD(fkrtl.biaya_tagih)
        - peserta.SUM(fktp.bobot)
        - peserta.MIN(fkrtl.biaya_tagih)
        - peserta.gender
        - peserta.COUNT(fktp)
        feature_engineering.selected_cols:
        - peserta.STD(fkrtl.lama_hari_kunjungan)
        - peserta.SUM(fkrtl.jml_kunjungan_fkrtl)
        - jml_kunjungan_fkrtl
        - status_pulang_peserta
        - MONTH(tanggal_pulang)
        - YEAR(tanggal_pulang)
        - peserta.SUM(fkrtl.lama_hari_kunjungan)
        - peserta.status_peserta
        - peserta.SUM(fktp.jarak_hari_antar_kunjungan)
        - MONTH(tanggal_datang)
        - kode_nama_diagnosis_primer_ICD10
        - kepemilikan_perujuk
        - peserta.provinsi_faskes
        - kode_casemix
        - jenis_perujuk
        - tipe_perujuk
        - peserta.MEAN(fktp.jarak_hari_antar_kunjungan)
        - peserta.segmen_peserta
        - kepemilikan_fkrtl
        - peserta.STD(fkrtl.spesifikasi_kelompok_kasus)
        - kode_nama_diagnosis_ICD10
        - peserta.MAX(fkrtl.tarif_drugs)
        - peserta.kab_kota_tempat_tinggal
        - kode_INACBGs
        - tipe_fkrtl
        - peserta.provinsi_tempat_tinggal
        - peserta.SUM(fktp.no_keluarga)
        - peserta.MEAN(fkrtl.spesifikasi_kelompok_kasus)
        - peserta.SUM(fkrtl.biaya_tagih)
        - kab_kota_fkrtl
        - peserta.MAX(fktp.jarak_hari_antar_kunjungan)
        - peserta.SUM(fkrtl.no_keluarga)
        - peserta.MIN(fkrtl.spesifikasi_kelompok_kasus)
        - peserta.SUM(fkrtl.bobot)
        - peserta.STD(fkrtl.biaya_tagih)
        - peserta.SUM(fktp.bobot)
        - peserta.MIN(fkrtl.biaya_tagih)
        - peserta.gender
        - peserta.COUNT(fktp)
    outs:
    - path: artifacts/scaler.pkl
      hash: md5
      md5: 98bd04a2582af9c693cb1ea38fb4e409
      size: 1815
    - path: data/feature_store/feature_store_peserta.csv
      hash: md5
      md5: d3ef9bf50737c8afad1ee9536b6bf984
      size: 3092760
    - path: data/interim/feature_matrix.csv
      hash: md5
      md5: f66296095d00a88cf1194e62dfb41d79
      size: 41016370
    - path: data/processed/final_data.parquet
      hash: md5
      md5: 7873001a33551ecdd337c6ee3490addb
      size: 2458355
    - path: data/processed/test.csv
      hash: md5
      md5: 67683fb49696d2042430783003063d7c
      size: 2294407
    - path: data/processed/train.csv
      hash: md5
      md5: b039679936948663fec26794f83f068f
      size: 9185741
